function isPointGender(e){return 9792===e||9794===e}function isPersonGender(e){return 128104===e||128105===e}function isFamilyMember(e){return 128118===e||128102===e||128103===e}function isVariationSelector(e){return e>=65024&&e<=65039||e>=917760&&e<=917999}function isDiversitySelector(e){return e>=127995&&e<=127999}function isFlagPoint(e){return e>=127462&&e<=127487}function unlikelyModifierBase(e){return e<9757||isPointGender(e)||isVariationSelector(e)||isDiversitySelector(e)||isFlagPoint(e)}function jsdecode(e){const t=e.length,n=[];for(let o=0;o<t;){const i=e.charCodeAt(o++)||0;if(i<55296||i>56319||o===t);else{const t=e.charCodeAt(o)||0;if(56320==(64512&t)){++o,n.push(65536+(1023&t)+((1023&i)<<10));continue}}n.push(i)}return n}function splitEmoji(e){if(!e.length)return[];let t=[{point:e[0],suffix:0}];const n=[t];for(let o=1;o<e.length;++o){const i=e[o];if(isFlagPoint(t[t.length-1].point));else{if(isDiversitySelector(i)||isVariationSelector(i)){t[t.length-1].suffix=i;continue}if(8205===i){const n=e[++o];n&&t.push({point:n,suffix:0});continue}}t=[{point:i,suffix:0}],n.push(t)}return n}function modify(e,t){const n={tone:!1,gender:{single:!1,double:!1,neutral:!1}};if(!e)return n;const o=splitEmoji(jsdecode(e)),i=t?[]:null;if(o.some((e,t)=>{const o=e[0].point;let r=0,s=!1;e.forEach(e=>{const t=e.point;if(isPointGender(t))n.gender.single=!0,n.gender.neutral=!0;else if(isPersonGender(t))n.gender.single=!0,++r>=2&&(n.gender.double=!0);else if(isFamilyMember(t)&&r)s=!0;else{const e=genderFlip(t);e&&(n.gender.single|=e.single,n.gender.neutral|=e.neutral)}});const a=r?isPersonGender(o)&&1===r&&!s:void 0;if(a&&(n.tone=basicDiversity),i&&(i[t]=a),(n.tone||!basicDiversity)&&n.gender.neutral)return!i&&n.gender.single&&n.gender.double;if(!1===a||unlikelyModifierBase(o))return;const l=String.fromCodePoint(o);basicDiversity&&!n.tone&&isSingle(l+"\u{1f3fb}")&&(n.tone=!0),!n.gender.neutral&&isSingle(l+"\u200d\u2640\ufe0f")&&(n.gender.neutral=!0,n.gender.single=!0)}),!t)return n;const r=function(){const e=t.gender||"";let n,o;return(t,i,r)=>{void 0===n||t!==n?(n=t,o=0):++o;const s=e?e[o%e.length]:"",a=i||0;if(isPersonGender(a))return s?"m"===s?128104:128105:a;if(!a||isPointGender(a))return s?"m"===s?9794:9792:0;if(r){const e=genderFlip(a);if(e){if(!s&&e.neutral)return e.points.n;if(s&&e.single)return"m"===s?e.points.m:e.points.f}}return--o,a}}(),s=o.map((e,n)=>{const o=[],s=i[n],a=e[0].point;if(void 0!==t.gender){const t=void 0===s;if(e.forEach(e=>e.point=r(o,e.point,t)),void 0===s&&1===e.length&&!isPointGender(a)){const t=r(o);t&&isSingle(String.fromCodePoint(a)+"\u200d\u2640\ufe0f")&&e.push({suffix:65039,point:t})}}return void 0!==t.tone&&e.forEach((e,n)=>{isDiversitySelector(e.suffix)?e.suffix=t.tone:0===n&&basicDiversity&&!1!==s&&(s||isSingle(String.fromCodePoint(a)+"\u{1f3fb}"))&&(e.suffix=t.tone)}),e.forEach(e=>{e.point&&(o.length&&o.push(8205),o.push(e.point),e.suffix&&o.push(e.suffix))}),o}).reduce((e,t)=>e.concat(t),[]);return n.out=String.fromCodePoint(...s),n}function datasetSafeDelete(e,...t){const n=e.dataset;t.forEach(e=>{e in n&&delete n[e]})}function upgrade(e){const t=e=>e<5e3&&32!=e,n=document.createElement("div");n.className="overflow-helper",e.parentNode.insertBefore(n,e);const o=document.createElement("div");o.className="underline",n.appendChild(o);const i=function(){const e=document.createElement("div");e.className="sizer",n.appendChild(e);const t=document.createElement("div");return t.className="nonce",n=>(e.textContent=n,e.appendChild(t),t.offsetLeft)}();"complete"!==document.readyState&&(o.classList.add("loading"),window.addEventListener("load",e=>{r(),o.classList.remove("loading")}));const r=()=>{if(void 0===e.dataset.from)return o.hidden=!0,!1;const[t,n]=[+e.dataset.from,+e.dataset.to],r=i(e.value.substr(0,t)),s=i(e.value.substr(t,n-t));s<0&&!document.getElementById("less")&&console.warn("invalid sizer width",s,"for text",sizer.textContent),o.hidden=s<=0,o.style.left=r+"px",o.style.width=s+"px",o.style.transform="translateX(-"+e.scrollLeft+"px)"},s=(t,n)=>t>=n?(datasetSafeDelete(e,"from","to","prefix","word","focus"),o.hidden=!0,!1):([e.dataset.from,e.dataset.to]=[t,n],e.dataset.focus=e.value.substr(t,n-t),r(),!0),a=e.value.length,l={start:a,end:a,value:void 0},c=n=>{if(!1!==n&&e.selectionStart===l.start&&e.selectionEnd===l.end&&e.value===l.value)return!0;if([l.start,l.end]=[e.selectionStart,e.selectionEnd],l.value!==e.value&&(e.dispatchEvent(new CustomEvent("value",{detail:e.value})),l.value=e.value),l.start!==l.end)return datasetSafeDelete(e,"prefix","word"),s(l.start,l.end),o.classList.add("range"),e.classList.add("range"),!1;o.classList.remove("range"),e.classList.remove("range");let i=l.start,r=l.start;const a=!e.value.substr(l.end).trim()||!t(e.value.charCodeAt(l.end));if(a){for(;r>0&&32===e.value.charCodeAt(r-1);--r);r<i&&(i=r)}for(;i>0&&t(e.value.charCodeAt(i-1));--i);for(;r<e.value.length&&t(e.value.charCodeAt(r));++r);i>=r&&a&&n||s(i,r)&&(e.dataset.focus=e.dataset.prefix=e.value.substr(i,r-i),datasetSafeDelete(e,"word"))};let d={};const u=(t,n)=>{if(t.has("focus")&&l.start===l.end&&([e.selectionStart,e.selectionEnd]=[l.start,l.end]),c(n))return;const o={text:e.dataset.prefix||e.dataset.word||null,prefix:"prefix"in e.dataset,focus:e.dataset.focus};o.text===d.text&&o.prefix===d.prefix&&o.focus===d.focus||(d=o,e.dispatchEvent(new CustomEvent("query",{detail:o})))};let f;!function(){let t,n=new Set;const o=e=>{t||(f=void 0,n.clear(),t=window.requestAnimationFrame(()=>{t=null,u(n,f)})),e&&n.add(e.type)};"change keydown keypress focus click mousedown select input".split(/\s+/).forEach(t=>e.addEventListener(t,o)),o(),e.addEventListener("mousemove",e=>{e.which&&o()}),document.addEventListener("selectionchange",t=>{document.activeElement===e&&o()});let i=!1;e.addEventListener("blur",t=>{e.scrollLeft&&(i=e.scrollLeft||!1),e.selectionStart===l.start&&e.selectionStart===l.end||([e.selectionStart,e.selectionEnd]=[l.start,l.end])},!0),e.addEventListener("focusout",t=>{!1!==i&&(e.scrollLeft=i,i=!1)},!0)}(),e.addEventListener("keydown",t=>{switch(t.key){case"Escape":f=!1;break;case" ":e.dataset.prefix&&e.selectionStart===+e.dataset.to&&e.dispatchEvent(new CustomEvent("request",{detail:e.dataset.prefix}))}}),e.addEventListener("keyup",t=>{if(229===t.keyCode||!t.keyCode){const t=e.value.substr(e.selectionStart-1,1);" "===t&&e.dataset.prefix&&e.dispatchEvent(new CustomEvent("request",{detail:e.dataset.prefix}))}}),function(){let t;const n=()=>{t||(t=window.requestAnimationFrame(()=>{t=null,r()}))};window.addEventListener("resize",n),e.addEventListener("wheel",n,{passive:!0})}();const p=t=>{if(void 0===e.dataset.from||void 0===e.dataset.to)return!1;const n=e.scrollLeft,[o,i]=[+e.dataset.from,+e.dataset.to],r=e.value.substr(o,i-o);let[a,c]=[typer.selectionStart,typer.selectionEnd];const d=t(r);if(null==d)return!1;typer.value=typer.value.substr(0,o)+d+typer.value.substr(i);const u=e=>(e>i?e=e-(i-o)+d.length:e>o&&(e=o+d.length),e);return typer.focus(),typer.dispatchEvent(new CustomEvent("change")),[l.start,l.end]=[typer.selectionStart,typer.selectionEnd]=[u(a),u(c)],f=!0,e.scrollLeft=n,s(o,o+d.length),!0};e.addEventListener("modifier",e=>{const t={[e.detail.type]:e.detail.code};p(e=>modify(e,t).out||"")}),e.addEventListener("emoji",t=>{const n=t.detail.choice;p(()=>n)&&(e.dataset.word=t.detail.word||"",datasetSafeDelete(e,"prefix"))})}function build(e,t=3,n=10){const o={},i={};return e.forEach(e=>{const r=e[0];i[r]=e.slice(1);const s=r.substr(0,t);for(let t=1;t<=s.length;++t){const e=s.substr(0,t);let i=o[e];i||(i=o[e]=[]),i.length<n&&i.push(r)}}),function(e,n){const r=(e=e.toLowerCase()).substr(t);let s=o[e.substr(0,t)]||[];return r&&(s=s.filter(e=>e.substr(t).startsWith(r))),n||(s=s.filter(t=>t===e)),(s=s.map(e=>[e,...i[e]])).length?s:[]}}function removeDuplicates(e){const t=new Set;return e.filter((e,n)=>{if(0!==n){if(t.has(e))return!1;t.add(e)}})}function merge(e,t){const n={};e.forEach(e=>n[e[0]]=e),t.forEach(t=>{const o=n[t[0]];if(!o)return n[t[0]]=t,void e.push(t);n[t[0]]=removeDuplicates(o.concat(t.slice(1)))})}function request(e,t,n=!1){if(!e)return Promise.resolve([]);const o=getPrefixGen().then(n=>n(e,t));if(!n)return o;let i=`${api}/query?query=${window.encodeURIComponent(e)}`;t&&(i+="&prefix=true");const r=window.fetch(i).then(e=>e.json()).then(e=>e.results);return Promise.all([o,r]).then(e=>{const[t,n]=e;return merge(t,n),t})}function refresh(){const e=adverts.querySelector(".active"),t=e&&e.nextElementSibling||adverts.firstElementChild;t?(e&&e.classList.remove("active"),t.classList.add("active"),enqueue()):console.warn("no adverts to choose from")}function enqueue(){window.clearTimeout(timeout),timeout=window.setTimeout(()=>{window.requestAnimationFrame(refresh)},1e4)}window.requestIdleCallback||(window.requestIdleCallback=(e=>{const t=performance.now(),n=e.bind(null,{didTimeout:!1,timeRemaining:()=>Math.max(0,50-(performance.now()-t))});return window.setTimeout(n,1)}),window.cancelIdleCallback=(e=>window.clearTimeout(e)));const all=Array.prototype.slice.call(buttons.querySelectorAll("button")),handler=e=>{const t=e.detail.trim(),n=Boolean(t);all.forEach(e=>e.disabled=!n)};typer.addEventListener("value",handler),handler({detail:typer.value}),function(e,t){let n;const o=e.textContent,i=/\s*/,r=r=>{const[s,a]=[t.selectionStart,t.selectionEnd];let l=0,c=t.value.length;if(t.selectionStart!==t.selectionEnd&&(l=t.selectionStart,c=t.selectionEnd),l+=i.exec(t.value.substr(l))[0].length,(c=l+t.value.substr(l,c-l).trim().length)<=l)return!1;t.focus(),t.selectionStart=l,t.selectionEnd=c;let d=!1;try{d=document.execCommand("copy")}catch(e){console.warn("could not copy",e),d=!1}if([t.selectionStart,t.selectionEnd]=[s,a],!d)return!0;console.info("copied",t.value.substr(l,c)),ga("send","event","text","copy"),e.textContent=e.dataset.copied,window.clearTimeout(n),n=window.setTimeout(t=>{e.textContent=o},500)};t.addEventListener("keydown",n=>{"Enter"==n.key&&(e.click(),t.focus())}),e.addEventListener("click",t=>{r(),e.focus()})}(copy,typer);const measureText=function(){const e=document.createElement("canvas").getContext("2d");e.font="1px monospace";let t={},n=0;return o=>{let i=t[o];return void 0===i&&(t[o]=i=e.measureText(o).width,++n>4e3&&(t={},n=0)),i}}(),fixedWidthEmoji=Boolean(/Mac|Android|iP(hone|od|ad)/),isSingle=function(){if(fixedWidthEmoji){const e=measureText("\u{1f602}");return t=>measureText(t)===e}if(-1!==window.location.search.indexOf("debug")){const e=context.measureText("\u{ffffd}").width;return console.info("invalid char has width",e),t=>{const n=measureText(t);return console.debug("isSingle",t,"has width",n),n!==e&&n<2*e}}const e=context.measureText("\u{ffffd}").width;return t=>{const n=measureText(t);return n!==e&&n<2*e}}(),isExpectedLength=function(){if(fixedWidthEmoji){const e=measureText("\u{1f602}");return t=>{const n=splitEmoji(jsdecode(t)),o=n.reduce((e,t)=>e+=isFlagPoint(t[0].point)?1:0,0),i=n.length-Math.ceil(o/2),r=measureText(t)/e;return Math.floor(r)===r&&r<=i}}context.measureText("\u{ffffd}").width;return e=>{const t=splitEmoji(jsdecode(e));for(let n=0;n<t.length;++n){const e=t[n];if(isFlagPoint(e[0].point)){if(n===t.length-1||!isFlagPoint(e[n+1].point))return!1;const o=String.fromCodePoint(...e[n].point,e[n+1].point);if(!isSingle(o))return!1;++n;continue}const o=String.fromCodePoint(...e.map(e=>e.point));if(!isSingle(o))return!1}return!0}}(),basicDiversity=measureText("\u{1f468}\u{1f3fb}")===measureText("\u{1f468}"),genderFlip=function(){const e=[129334,127877,0,128131,128378,0,128112,129333,0,128103,128102,0,128117,128116,129491,128109,128108,0,128120,129332,0],t=new Map;for(let n=0;n<e.length;n+=3){const o={points:{f:e[n],m:e[n+1],n:e[n+2]}};for(let i=0;i<3;++i){const r=e[n+i];if(r){if(t.has(r))throw new Error("duplicate in gender list: "+r);t.set(r,o)}}}return e=>{const n=t.get(e)||null;return n&&void 0===n.single&&(n.single=isSingle(String.fromCodePoint(n.points.f))&&isSingle(String.fromCodePoint(n.points.m)),n.neutral=n.points.n&&isSingle(String.fromCodePoint(n.points.n))),n}}();upgrade(typer);const api="https://us-central1-emojityper.cloudfunctions.net",getPrefixGen=function(){let e=null;const t=window.localStorage.popular;if(t){let n;try{n=JSON.parse(t)}catch(e){console.debug("couldn't parse localStorage popular",e),n=null}if(n&&(e=Promise.resolve(build(n.results)),n.created>=+new Date-864e5))return()=>e}const n=new Promise((e,t)=>{const n=new XMLHttpRequest;n.open("GET",api+"/popular"),n.onerror=t,n.responseType="json",n.onload=(()=>e(n.response)),n.send()}).then(e=>"string"==typeof e?JSON.parse(e):e);n.then(e=>{window.loader.hidden=!0,e.created=+new Date,window.localStorage.popular=JSON.stringify(e)});const o=n.then(e=>build(e.results));if(!e)return window.loader.hidden=!1,()=>o;let i=e;return o.then(()=>i=o),()=>i}(),select=function(){let e,t,n,o={};const i=()=>{const e=JSON.stringify(o);o={};const i=window.fetch(api+"/select",{method:"POST",body:e});if(!n)throw new Error("got fetch without eventualResolve");t=null,n(i)};return function(r,s){return o[r]=s,t||(t=new Promise(e=>n=e)),window.clearTimeout(e),e=window.setTimeout(i,5e3),t}}(),predicateTrue=()=>!0;class ButtonManager{constructor(e){this.holder_=e,this.pendingFirstEmoji_=null,this.options_=new Map,this.buttons_=new Map,this.setModifier=(()=>{const e=ButtonManager.optionType_("modifier","gender"),t=ButtonManager.optionType_("modifier","tone");this.holder_.appendChild(e),this.holder_.appendChild(t);const n=(e,t=null)=>{const n=document.createElement("button");return n.textContent=e,n.dataset.value=t,n},o=[n("\u2014",""),n("\u2640","f"),n("\u2640\u2642","fm"),n("\u2642","m"),n("\u2642\u2640","mf")],i=[t.appendChild(n("\u2014",""))];for(let s=127995;s<=127999;++s)i.push(n(String.fromCodePoint(s),s));const r=(e,t,n)=>{e?n.appendChild(t):t.remove()};return function(n){o.forEach(t=>{const o=t.dataset.value.length,i=!o&&n.gender.neutral||1===o&&n.gender.single||2===o&&n.gender.double;r(i,t,e)}),i.forEach(e=>r(n.tone,e,t)),this.holder_.insertBefore(e,e.nextSibling),this.holder_.insertBefore(t,t.nextSibling)}})()}static optionType_(e,t){const n=document.createElement("div");return n.className="options "+e,n.setAttribute("data-"+e,t),n}static option_(e){const t=document.createElement("div");return t.className="options",t.setAttribute("data-name",e),t}static button_(e){const t=document.createElement("button");return t.className="unknown",t.textContent=e,t}immediateFirstEmojiForOption_(e){const t=this.options_.get(e);if(!t)return null;let n=t.firstElementChild;for(;n;){if(!n.hidden&&""===n.className)return n.textContent;n=n.nextElementSibling}return null}checkFirstEmoji_(){this.pendingFirstEmoji_&&this.pendingFirstEmoji_()}firstEmojiForOption(e){return e?new Promise(t=>{const n=()=>{const o=this.immediateFirstEmojiForOption_(e);if(!o)return!1;this.pendingFirstEmoji_===n&&(this.pendingFirstEmoji_=null),t(o)};this.pendingFirstEmoji_=n,n()}):Promise.resolve(null)}localFilter(e,t){let n=predicateTrue;if(!0===t){const t=e.length;0!==t&&(n=(n=>n.length>=t&&n.substr(0,t)===e))}else n=(t=>t===e);this.options_.forEach((e,t)=>e.hidden=!n(t))}update(e){const t=new Map,n=new Map,o=this.holder_.contains(document.activeElement)?document.activeElement:null,i=[];return e.forEach(e=>{const o=e[0],r=this.options_.get(o)||ButtonManager.option_(o);this.options_.delete(o),t.set(o,r),r.hidden=!0,this.holder_.appendChild(r);for(let t,s=1;t=e[s];++s){if(n.has(t))continue;let e=this.buttons_.get(t);e?(this.buttons_.delete(t),e.className||(r.hidden=!1)):(e=ButtonManager.button_(t),i.push({emoji:t,button:e})),n.set(t,e),r.appendChild(e)}}),this.options_.forEach(e=>e.remove()),this.buttons_.forEach(e=>e.remove()),this.options_=t,this.buttons_=n,o&&(o.parentNode?o.focus():typer.focus()),async function(){let e=0,t=null;const n=window.performance.now();for(let o=0;o<i.length;++o){const{emoji:r,button:s}=i[o];if(!s.parentNode)continue;if(isExpectedLength(r)?(s.className="",s.parentNode.hidden=!1,++e):s.remove(),o<20||null===t&&window.performance.now()-n<10)continue;let a=!0;null!==t&&(a=t.timeRemaining()<0),a&&(this.checkFirstEmoji_(),t=await new Promise(e=>window.requestIdleCallback(e)))}return this.checkFirstEmoji_(),e}.call(this)}}let spaceFrame=0;chooser.addEventListener("keyup",e=>{" "===e.key&&"button"===e.target.localName&&(spaceFrame=window.setTimeout(()=>spaceFrame=0,0))}),chooser.addEventListener("click",e=>{let t=void 0;const n=e.target;if("button"!==n.localName);else if(n.parentNode.dataset.modifier){const e="value"in n.dataset?+n.dataset.value||n.dataset.value:null,o={type:n.parentNode.dataset.modifier,code:e};typer.dispatchEvent(new CustomEvent("modifier",{detail:o})),t="modifier"}else if(n.parentNode.dataset.name){const o=0!==spaceFrame||e.metaKey||e.ctrlKey,i=o?n.parentNode.dataset.name:null,r={choice:n.textContent,word:i};typer.dispatchEvent(new CustomEvent("emoji",{detail:r})),select(n.parentNode.dataset.name,r.choice),t="emoji"}t&&ga("send","event","options","click",t)}),typer.addEventListener("keydown",e=>{if("ArrowDown"===e.key||"Down"===e.key){const e=chooser.querySelector("button");e&&(e.focus(),ga("send","event","options","keyboardnav"))}});const arrowKeys=["Left","Right","Up","Down"],isArrowKey=e=>e.startsWith("Arrow")||-1!==arrowKeys.indexOf(e);chooser.addEventListener("keydown",e=>{switch(e.key){case"Escape":typer.focus()}if(!isArrowKey(e.key))return;if(!document.activeElement||!chooser.contains(document.activeElement))return;const t=Array.from(chooser.querySelectorAll("button")),n=t.indexOf(document.activeElement);if(-1===n)return;let o;if("ArrowLeft"===e.key||"Left"===e.key?o=-1:"ArrowRight"!==e.key&&"Right"!==e.key||(o=1),o){const e=n+o;return void(e>=0&&e<t.length&&t[e].focus())}if("ArrowUp"===e.key||"Up"===e.key)o=-1;else{if("ArrowDown"!==e.key&&"Down"!==e.key)return;o=1}const i=document.activeElement.getBoundingClientRect(),r={dist:1/0,button:null};let s=void 0,a=n;for(;(a+=o)>=0&&a<t.length;){const e=t[a],n=e.getBoundingClientRect();if(i.top===n.top)continue;if(void 0===s&&(s=n.top),n.top!==s)break;const o=Math.abs(n.left-i.left);o<r.dist&&([r.dist,r.button]=[o,e])}r.button?r.button.focus():void 0===s&&o<0&&typer.focus()}),function(){const e=new ButtonManager(chooser);let t={},n=performance.now(),o=null;typer.addEventListener("query",i=>{const r=modify(!i.detail.prefix&&i.detail.focus||"");e.setModifier(r),o=null;let s=!1;const a=performance.now(),l=i.detail;t.text&&t.prefix===l.prefix?a-n>2e3&&(s=!0):s=!0,t=l,n=a;const c=async(n=0,o=!1)=>{if(n&&(await new Promise(e=>window.setTimeout(()=>{window.requestAnimationFrame(e)},n)),t!==l))return-1;const i=await request(l.text,l.prefix,o);return t!==l?-1:e.update(i)};c(s?0:250).then(e=>{if(e<0)return-2;const t=Math.max(1e3,100*Math.pow(e,.75));return c(t,!0)}).catch(e=>{console.error("error doing request",e)})});const i=/[^\w:\.,$%^\-']+/g,r=e=>e.replace(i,"").toLowerCase();typer.addEventListener("request",t=>{const n=r(t.detail||""),i=e.firstEmojiForOption(n);o=i,i.then(e=>{if(o!==i)return;ga("send","event","options","typing");const t={choice:e,word:n};typer.dispatchEvent(new CustomEvent("emoji",{detail:t}))})})}();const value=e=>{e.detail.trim()?document.body.classList.add("has-value"):document.body.classList.remove("has-value")};typer.addEventListener("value",value),value({detail:typer.value});const resize=e=>{const t=window.innerHeight;document.body.style.minHeight=`${t}px`};window.addEventListener("resize",resize),resize();const adverts=document.getElementById("adverts");let timeout;enqueue(),navigator.serviceWorker&&navigator.serviceWorker.register("./sw.js").catch(e=>{console.warn("failed to register SW",e)});

//# sourceMappingURL=bundle.min.js.map
